<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultrasound</title>
  <link href="../../node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../custom_css/style.css" rel="stylesheet">
</head>


<body>
  <div class="container my-5 w-50 mt-5 py-5">
    <h1 class="heading1 d-flex justify-content-center primary py-4"><span style="color: #0d6efd; font-family: 'Courier New', Courier, monospace;">ultra</span>sound</h1>
    
    <form class="row g-3" id="ultrasoundForm">
      <div class="col-md-4">
        <label for="cardnum" class="form-label">card number</label>
        <input type="number" placeholder="Enter patient's card number" class="form-control" id="patientId" required>
      </div>
      <div class="col-md-4">
        <label for="headCircum" class="form-label">Head circumference (m)</label>
        <input type="number" placeholder="Enter head circumference" class="form-control" name="headCircumference" required>
      </div>
      <div class="col-md-4">
        <label for="fermLen" class="form-label">fermur length (m)</label>
        <input type="number" placeholder="Enter fermur length" class="form-control" name="femurLength" required>
        </div>
      
      <div class="col-md-4">
        <label for="abdomCircum" class="form-label">abdominal circumference (m)</label>
        <input type="number" placeholder="Enter abdominal circumference" class="form-control" name="abdominalCircumference" required>
      </div>

      <div class="col-md-4">
        <label for="bipaDia" class="form-label">Biparietal diameter (m)</label>
        <input type="number" placeholder="Enter biparietal diameter" class="form-control" name="biparietalDiameter" required>
      </div>
      <div class="col-md-4">
        <label for="date" class="form-label">date of measurement</label>
        <input type="date" class="form-control" name="dateOfUltrasound" required>
      </div>
      <div class="col-12 sub-button d-flex justify-content-center">
        <button class="btn btn-primary w-100" type="submit">Submit</button>
      </div>
    </form>
  </div>

  <script>

        // create Ultrasound data
    let redirect = (path)=>{
      window.open(path, "_blank")
    }
    const ultrasoundForm = document.querySelector("#ultrasoundForm")
    ultrasoundForm.addEventListener("submit", (event)=>{
      event.preventDefault();

      let cardNumber = document.querySelector("#patientId").value;
      let apiUrl = `http://localhost:3000/api/v1/patient/ultrasound/${cardNumber}`

      const formData = new FormData(ultrasoundForm);

      const jsObject = {}
      for (const [key,value] of formData.entries()){
        jsObject[key] = value
      }
      const jsonString = JSON.stringify(jsObject)
      console.log(jsonString)
      //send form data to server
      fetch(apiUrl, {
        method: "POST",
        headers:{
          'Content-Type': "application/json"
        },
        body: jsonString
      })
      .then(res=>res.json())
      .then(data=>{
        console.log(data)

        if(data.error === "unauthorized"){
          alert(data.message)
        }else{
          localStorage.setItem("fetchedData", JSON.stringify(data))
          redirect("../view/ultrasoundView.html");
        }  
      })
      .catch(error=>console.error("error occured while fetching data: ", error))

    })
  </script>

  

   

  
  <!-- <script src="../node_modules/jquery/dist/jquery.min.js"></script> -->
  <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

  
  <!-- <script src="../node_modules/jquery/dist/jquery.min.js"></script> -->
  <script src="../../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>